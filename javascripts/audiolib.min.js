/*
	audiolib.js
	Jussi Kalliokoski
	https://github.com/jussi-kalliokoski/audiolib.js
	MIT license
*//*
	wrapper-start.js
	Please note that the file is not of valid syntax when standalone.
*/this.audioLib=function a(b,c,d,e){function h(a){var b=new f(a);return b.subarray=b.subarray||b.slice,b}function j(a,b,c,d){i?i(a,b,{get:function(){return c},enumerable:!!d}):a[b]=c}function k(a){var b=arguments,c=b.length,d,e;for(d=1;d<c;d++)for(e in b[d])b[d].hasOwnProperty(e)&&(a[e]=b[d][e]);return a}function l(a,b,c){var d;for(d in a)(a.hasOwnProperty(d)||c)&&b.call(a,a[d],d);return a}function m(a,b,c){var d,f;if(!c){c=[],d=/^\s*function\s*\w*\s*\(([^\)]+)/.exec(b);if(d)d[1].replace(/[a-z$_0-9]+/ig,function(a){c.push(a)});else for(d=0;d<b.length;d++)c[d]=e(d+2).join("_")}return f=Function("var __q;return function "+a+"("+c.join()+"){var i; if(__q){__q=!__q}else if(this instanceof "+a+")this.__CLASSCONSTRUCTOR.apply(this,arguments);else{__q=!__q;i=new "+a+";i.__CLASSCONSTRUCTOR.apply(i,arguments);return i}};")(),f.prototype=b.prototype,f.prototype.__CLASSCONSTRUCTOR=b,k(f,b),f}function n(a,b,c,d){this.parameter=a,this.automation=b,this.amount=isNaN(c)?this.amount:c,this.setType(d)}function o(a,b,c,d,e){if(!a.automation){a.automation=[];switch(a.type){case"generator":a.append=o.generatorAppend;break;case"effect":a.append=o.effectAppend;break;case"buffereffect":a.append=o.bufferEffectAppend}}var c=new n(b,c,d,e);return a.automation.push(c),c}function p(a,b){p[a]=b,p._pluginList.push({plugin:b,name:a})}function q(a,b){var c=a[0].toUpperCase()+a.substr(1).toLowerCase();return q[a]=b,b.decode&&(g.Sampler.prototype["load"+c]=function(b){this.load.apply(this,[q[a].decode(b)].concat([].slice.call(arguments,1)))}),b.encode&&(g.AudioDevice.Recording.prototype["to"+c]=function(b){return q[a].encode({data:this.join(),sampleRate:this.boundTo.sampleRate,channelCount:this.boundTo.channelCount,bytesPerSample:b})}),b}function r(a,b,c){function d(){a.apply(this,c)}this.channelCount=isNaN(b)?this.channelCount:b,this.effects=[],d.prototype=a.prototype;while(b--)this.effects.push(new d)}function s(){}function t(){}function v(a,b){var d=this,e=0;d.sampleRate=a,d.resolution=b?c.pow(2,b-1):c.pow(2,7),d.pushSample=function(a){return e=c.floor(a*d.resolution+.5)/d.resolution,e},d.getMix=function(){return e}}function w(a,b,c,d){this.sampleRate=isNaN(a)?this.sampleRate:a,this.threshold=isNaN(b)?this.threshold:b,this.attack=isNaN(c)?this.attack:c,this.release=isNaN(d)?this.release:d,this._amplitude=new g.Amplitude(this.sampleRate,this.attack,this.release)}function x(a,b,c,d,e,f,h){var i=this;i.sampleRate=a,i.channelCount=isNaN(b)?i.channelCount:b,i.wet=isNaN(c)?i.wet:c,i.dry=isNaN(d)?i.dry:d,i.roomSize=isNaN(e)?i.roomSize:e,i.damping=isNaN(f)?i.damping:f,i.tuning=new x.Tuning(h||i.tuning),i.sample=function(){var a=[],b;for(b=0;b<i.channelCount;b++)a[b]=0;return a}(),i.CFs=function(){var a=[],b=[],c=i.tuning.combCount,d=i.damping*i.tuning.scaleDamping,e=i.roomSize*i.tuning.scaleRoom+i.tuning.offsetRoom,f=i.tuning.combTuning,h,j;for(j=0;j<i.channelCount;j++){for(h=0;h<c;h++)b.push(new g.CombFilter(i.sampleRate,f[h]+j*i.tuning.stereoSpread,e,d));a.push(b),b=[]}return a}(),i.numCFs=i.CFs[0].length,i.APFs=function(){var a=[],b=[],c=i.tuning.allPassCount,d=i.tuning.allPassFeedback,e=i.tuning.allPassTuning,f,g;for(g=0;g<i.channelCount;g++){for(f=0;f<c;f++)b.push(new x.AllPassFilter(i.sampleRate,e[f]+g*i.tuning.stereoSpread,d));a.push(b),b=[]}return a}(),i.numAPFs=i.APFs[0].length}function y(a,b,c,d){var e=this;e.sampleRate=a,e.buffer=new h(isNaN(b)?1200:b),e.bufferSize=e.buffer.length,e.feedback=isNaN(c)?e.feedback:c,e.damping=isNaN(d)?e.damping:d,e.invDamping=1-e.damping}function z(a,b,d,e){function o(){h=2*l(c.PI*m(.25,f.cutoff/(f.samplerate*2))),i=m(2*(1-n(f.resonance,.25)),m(2,2/h-h*.5))}var f=this,g=[0,0,0,0],h,i,j,k,l=c.sin,m=c.min,n=c.pow;f.cutoff=isNaN(b)?2e4:b,f.resonance=d?d:.1,f.samplerate=isNaN(a)?44100:a,f.type=e||0,f.pushSample=function(a){if(j!==f.cutoff||k!==f.resonance)o(),j=f.cutoff,k=f.resonance;return g[3]=a-i*g[2],g[0]=g[0]+h*g[2],g[1]=g[3]-g[0],g[2]=h*g[1]+g[2],g[3]=a-i*g[2],g[0]=g[0]+h*g[2],g[1]=g[3]-g[0],g[2]=h*g[1]+g[2],g[f.type]},f.getMix=function(a){return g[a||f.type]}}function A(a,b,c,d,e,f){this.reset.apply(this,arguments)}function B(a,b,c){var d=this,e=0;d.sampleRate=a,d.scale=b||1,d.gain=isNaN(c)?.5:c,d.pushSample=function(a){return a/=d.scale,e=(1+d.gain)*a-d.gain*a*a*a,e},d.getMix=function(){return e}}function C(a,b,d,e){function k(){g=new h(f.sampleRate*.1),i=0;var a,b=g.length;for(a=0;a<b;a++)g[a]=0}var f=this,g,i,j;f.delayTime=b||30,f.depth=d||3,f.freq=e||.1,f.sampleRate=a,f.osc=new I(a,e),f.calcCoeff=k,f.pushSample=function(a){++i>=g.length&&(i=0),g[i]=a,f.osc.generate();var b=f.delayTime+f.osc.getMix()*f.depth;b*=f.sampleRate/1e3,b=i-c.floor(b);while(b<0)b+=g.length;return j=g[b],j},f.getMix=function(){return j},k()}function D(a,b,d){function o(){i=h*e.cutoff/e.samplerate,j=1-i/(2*(e.resonance+.5/(1+i))+i-2),k=j*j,l=k+1-2*c.cos(i)*j}var e=this,f=0,g=0,h=c.PI*2,i,j,k,l,m,n;e.cutoff=b?b:2e4,e.resonance=d?d:1,e.samplerate=a,e.pushSample=function(a){if(m!==e.cutoff||n!==e.resonance)o(),m=e.cutoff,n=e.resonance;return f+=(a-g)*l,g+=f,f*=k,g},e.getMix=function(){return g},o()}function E(a,b,c){var d=this;d.time=isNaN(b)?d.time:b,d.feedback=isNaN(c)?d.feedback:c,d.reset(a)}function F(a){var b=new z(a,720.484),d=new z(a,723.431),e=new z(a,1),f=0;this.gain=4,this.master=1,this.sampleRate=a,this.filters=[b,d,e],this.pushSample=function(a){return b.pushSample(a),f=b.getMix(1)*this.gain,f=c.atan(f)+f,f>.4?f=.4:f<-0.4&&(f=-0.4),d.pushSample(f),e.pushSample(d.getMix(0)),f=e.getMix(1)*this.master,f},this.getMix=function(){return f}}function G(a,b){this.sampleRate=isNaN(a)?this.sampleRate:a,this.setParam("kernels",b||new h(1))}function H(a,b){this.sampleRate=isNaN(a)?this.sampleRate:a,this.gain=isNaN(b)?this.gain:b}function I(a,b){var c=this;c.frequency=isNaN(b)?440:b,c.waveTable=new h(1),c.sampleRate=a,c.waveShapes=c.waveShapes.slice(0)}function J(){this.reset.apply(this,arguments)}function K(a,b){var c=this;c.voices=[],c.sampleRate=a,c.pitch=isNaN(b)?440:c.pitch}function L(a){var b;for(b in L.prototype)L.prototype.hasOwnProperty(b)&&(this[b]=L.prototype[b]);this.resetBuffer.apply(this,arguments)}function N(a,b,c){this.sampleRate=isNaN(a)?this.sampleRate:a,this.attack=isNaN(b)?this.attack:b,this.decay=isNaN(c)?this.decay:c}function O(a,b,c,d,e,f,g){this.sampleRate=isNaN(a)?this.sampleRate:a,this.attack=isNaN(b)?this.attack:b,this.decay=isNaN(c)?this.decay:c,this.sustain=isNaN(d)?this.sustain:d,this.release=isNaN(e)?this.release:e,this.sustainTime=isNaN(f)?null:f,this.releaseTime=isNaN(g)?null:g}function P(a,b){this.sampleRate=isNaN(a)?this.sampleRate:a,this.schedule=[],this.reset(b)}function Q(a,b,c,d){var e=this,f=0;this.sampleRate=isNaN(a)?this.sampleRate:a,this.stepLength=isNaN(b)?this.stepLength:b,this.steps=c||[1,0],this.attack=isNaN(d)?this.attack:d}var f=b.Float32Array||e,g=this;g.Float32Array=h;var i=function(){if(d.defineProperty)return d.defineProperty;if(d.prototype.__defineGetter__)return function(a,b,c){c.get&&a.__defineGetter__(b,c.get),c.set&&a.__defineSetter__(b,c.set)}}();j(g,"__define",i),j(g,"__defineConst",j),j(g,"__extend",k),j(g,"__enum",l),j(g,"__class",m),n.prototype={parameter:"",automation:null,amount:1,type:"modulation",mode:null,setType:function(a){a?(typeof a=="function"&&(this.type=a.name||"custom",this.mode=a),this.type=a,this.mode=o.modes[a]):this.mode=this.mode||o.modes[this.type]}},o.generatorAppend=function(a,b,c){var d=this,e=a.length,f=d.automation.length,g=[],h,i,j,k,l;c=c||a,b=b||d.channelCount;for(k=0;k<f;k++)g.push(d[d.automation[k].parameter]);for(i=0,h=0;i<e;i+=b,h++){for(k=0;k<f;k++)d[d.automation[k].parameter]=g[k];for(k=0;k<f;k++)l=d.automation[k],l.mode(d,l.parameter,l.amount*l.automation.generatedBuffer[h]);d.generate();for(j=0;j<b;j++)c[i+j]=d.getMix(j)*d.mix+a[i+j]}for(k=0;k<f;k++)d[d.automation[k].parameter]=g[k];return c},o.effectAppend=function(a,b,c){var d=this,e=a.length,f=d.automation.length,g=[],h,i,j,k,l;c=c||a,b=b||d.channelCount;for(k=0;k<f;k++)g.push(d[d.automation[k].parameter]);for(i=0,h=0;i<e;i+=b,h++){for(k=0;k<f;k++)d[d.automation[k].parameter]=g[k];for(k=0;k<f;k++)l=d.automation[k],l.mode(d,l.parameter,l.amount*l.automation.generatedBuffer[h]);for(j=0;j<b;j++)d.pushSample(a[i+j],j),c[i+j]=d.getMix(j)*d.mix+a[i+j]*(1-d.mix)}for(k=0;k<f;k++)d[d.automation[k].parameter]=g[k];return c},o.bufferEffectAppend=function(a,b,c){var d=this,e=b||d.channelCount,f=a.length,g=d.automation.length,h=[],i,j,k,l,m,n;c=c||a;for(k=0;k<g;k++){h.push([]);for(j=0;j<e;j++)h[k].push(d.effects[j][d.automation[k].parameter])}for(n=0,i=0;i<f;i+=e,n++)for(j=0;j<e;j++){for(k=0;k<g;k++)m=d.automation[k],d.effects[j][m.parameter]=h[k][j],m.mode(d.effects[j],m.parameter,m.amount*m.automation.generatedBuffer[n]);c[i+j]=d.effects[j].pushSample(a[i+j])*d.mix+a[i+j]*(1-d.mix)}for(k=0;k<g;k++)for(j=0;j<e;j++)d.effects[j][d.automation[k].parameter]=h[k][j];return c},o.modes={modulation:function(a,b,c){a.setParam(b,a[b]*c)},addition:function(a,b,c){a.setParam(b,a[b]+c)},subtraction:function(a,b,c){a.setParam(b,a[b]-c)},additiveModulation:function(a,b,c){a.setParam(b,a[b]+a[b]*c)},subtractiveModulation:function(a,b,c){a.setParam(b,a[b]-a[b]*c)},assignment:function(a,b,c){a.setParam(b,c)},absoluteAssignment:function(a,b,d){a.setParam(b,c.abs(d))}},o.__constructror=n,j(p,"_pluginList",[],!1),r.prototype={mix:.5,type:"buffereffect",channelCount:2,append:function(a,b,c){var d=this,e=a.length,f,g;b=b||d.channelCount,c=c||a;for(f=0;f<e;f+=b)for(g=0;g<b;g++)d.effects[g].pushSample(a[f+g],0),c[f+g]=d.effects[g].getMix(0)*d.mix+a[f+g]*(1-d.mix);return c},addPreProcessing:function(){var a;for(a=0;a<this.effects.length;a++)this.effects[a].addPreProcessing.apply(this.effects[a],arguments)},removePreProcessing:function(){var a;for(a=0;a<this.effects.length;a++)this.effects[a].removePreProcessing.apply(this.effects[a],arguments)},setParam:function(a,b){var c=this.effects.length,d;for(d=0;d<c;d++)this.effects[d].setParam(a,b)}},s.prototype={type:"effect",sink:!0,source:!0,mix:.5,channelCount:1,append:function(a,b,c){var d=a.length,e,f;c=c||a,b=b||this.channelCount;for(e=0;e<d;e+=b)for(f=0;f<b;f++)this.pushSample(a[e+f],f),c[e+f]=this.getMix(f)*this.mix+a[e+f]*(1-this.mix);return c},addPreProcessing:function(a){a.pushSample=this.pushSample,this.pushSample=function(){return a.apply(this,arguments),a.pushSample.apply(this,arguments)}},removePreProcessing:function(a){var b;while(b=this.pushSample.pushSample)if(b===a||!a)this.pushSample=b,a.pushSample=null},setParam:function(a,b){this[a]=b},pushSample:function(){},getMix:function(){},reset:function(){}},t.prototype={type:"generator",source:!0,mix:1,generatedBuffer:null,channelCount:1,append:function(a,b,c){var d=a.length,e,f;c=c||a,b=b||this.channelCount;for(e=0;e<d;e+=b){this.generate();for(f=0;f<b;f++)c[e+f]=this.getMix(f)*this.mix+a[e+f]}return c},addPreProcessing:function(a){a.generate=this.generate,this.generate=function(){return a.apply(this,arguments),a.generate.apply(this,arguments)}},removePreProcessing:function(a){var b;while(b=this.generate.generate)if(b===a||!a)this.generate=b,a.generate=null},generateBuffer:function(a,b){this.generatedBuffer=new h(a),this.append(this.generatedBuffer,b||1)},setParam:function(a,b){this[a]=b},generate:function(){},getMix:function(){},reset:function(){}},function(){function b(){var a=arguments,b=a.length,c,d;for(d=0;d<b;d++)c=a[d],this.postMessage({type:"injection",code:c instanceof Function?"("+String(c)+").call(this);":c})}g.AudioWorker=function(c,d){var e="var audioLib=("+String(a)+").call({},this,Math,Object,Array);\n",f;for(f=0;f<g.plugins._pluginList.length;f++)e+="("+String(g.plugins._pluginList[url])+"());\n";return d&&(e+='this.addEventListener("message",function(e){e.data&&e.data.type==="injection"&&Function(e.data.code).call(this)},true);\n'),e+=c instanceof Function?"("+String(c)+").call(this);":c.textContent||c,e=u.inlineWorker(e),d&&(e.inject=b),e}}(),function(a,b){function f(a,b){return b?c(a&255)+f(a>>8,b-1):""}function g(a,b){return b?g(a>>8,b-1)+c(255-a&255):""}function h(a,b,c){return c?g(a,b):f(a,b)}function i(a,c){var d=a.length,e=d-1,f=0,g=b.pow,h;if(c)for(h=0;h<d;h++)f+=(255-a.charCodeAt(h))*g(256,e-h);else for(h=0;h<d;h++)f+=a.charCodeAt(h)*g(256,h);return f}function j(a,c,d,e){var f=b.pow,g=b.floor,h=j.convertFromBinary,i=j.convertToBinary,k=a/8,l=f(2,a),m=l/2,n=m-1,o=1/m,p=1/n;return e?d?c?function(a,b){return a=g(a<0?a*m+l:a*n),i(a,k,b)}:function(a,b){return i(g(a*n),k,b)}:c?function(a,b){return i(a<0?a+l:a,k,b)}:function(a,b){return i(a,k,b)}:d?c?function(a,b){var c=h(a,b);return c>n?(c-l)*o:c*p}:function(a,b){return h(a,b)*p}:c?function(a,b){var c=h(a,b);return c>n?c-l:c}:function(a,b){return h(a,b)}}var c=String.fromCharCode,d=!0,e=!1;j.convertToBinary=h,j.convertFromBinary=i,j.fromQ32=j(32,d,d,d),j.toQ32=j(32,d,d,e),j.fromQ24=j(24,d,d,d),j.toQ24=j(24,d,d,e),j.fromQ16=j(16,d,d,d),j.toQ16=j(16,d,d,e),j.fromQ8=j(8,d,d,d),j.toQ8=j(8,d,d,e),j.fromInt32=j(32,d,e,d),j.toInt32=j(32,d,e,e),j.fromInt16=j(16,d,e,d),j.toInt16=j(16,d,e,e),j.fromInt8=j(8,d,e,d),j.toInt8=j(8,d,e,e),j.fromUint32=j(32,e,e,d),j.toUint32=j(32,e,e,e),j.fromUint16=j(16,e,e,d),j.toUint16=j(16,e,e,e),j.fromUint8=j(8,e,e,d),j.toUint8=j(8,e,e,e),a.Binary=j}(this,c),function(a,b){function c(a){this.data=a}function g(a,b,c){var e=b/8;d["read"+a+b]=function(a){return c(this.read(e),a)}}var d=c.prototype={read:function(a){var b=this,c=b.data.substr(0,a);return b.skip(a),c},skip:function(a){var b=this,c=b.data=b.data.substr(a);return b.pointer+=a,c.length},readBuffer:function(a,b,c){var d=this,e="read"+c+b,f=b/8,g=a.length,h=0;while(d.data&&h<g)a[h++]=d[e]();return h}},e,f;for(e in b)f=/to([a-z]+)([0-9]+)/i.exec(e),f&&g(f[1],f[2],b[e]);a.Stream=c,c.newType=g}(this,this.Binary),this.PCMData=function(a,b){function d(a){return(typeof a=="string"?d.decode:d.encode)(a)}return d.decodeFrame=function(a,c,d){if(c===8){var f=new(window.Uint8Array||e)(d.length);(new b(a)).readBuffer(f,8,"Uint");for(c=0;c<d.length;c++)d[c]=(f[c]-127.5)*127.5}else(new b(a)).readBuffer(d,c,"Q");return d},d.encodeFrame=function(b,c){var d=a[(c===8?"fromUint":"fromQ")+c],e=b.length,f="",g;if(c===8)for(g=0;g<e;g++)f+=d(b[g]*127.5+127.5);else for(g=0;g<e;g++)f+=d(b[g]);return f},d.decode=function(a,c){function D(){u=f.read(4),v=f.readUint32(),x=f.read(v),z=B[u]=B[u]||[],u==="data"?(w=~~(v/s),y=C.data=new(typeof h!="undefined"?h:e)(w),d.decodeFrame(x,s*8,y)):z.push(x),c&&(f.data?setTimeout(D,1):c(C))}var f=new b(a),g=f.read(4),i=f.readUint32();f=new b(f.read(i));var j=f.read(4),k=f.read(4),l=f.readUint32(),m=new b(f.read(l)),n=m.readUint16(),o=m.readUint16(),p=m.readUint32(),q=m.readUint32(),r=m.readUint16(),s=r/o,t=m.readUint16(),u,v,w,x,y,z,A,B={},C={channelCount:o,bytesPerSample:r/o,sampleRate:q/r,chunks:B,data:y};if(c)f.data?D():c(C);else while(f.data)D();return C},d.encode=function(b,e){var f=a.fromUint32,g=a.fromUint16,h=b.data,i=b.sampleRate,j=b.channelCount||1,k=b.bytesPerSample||1,l=k*8,m=j*k,n=i*m,o=h.length,p=o*k,q=c.pow(2,l-1)-1,r=[],s="",t,u,v,w;r.push("fmt "+f(16)+g(1)+g(j)+f(i)+f(n)+g(m)+g(l)),r.push("data"+f(p)+d.encodeFrame(h,l)),w=b.chunks;if(w)for(u in w)if(w.hasOwnProperty(u)){t=w[u];for(v=0;v<t.length;v++)s=t[v],r.push(u+f(s.length)+s)}return r=r.join(""),r="RIFF"+f(r.length)+"WAVE"+r,e&&setTimeout(function(){e(r)},1),r},d}(this.Binary,this.Stream);var u=this.Sink=function(a){function b(a,c,d,e){var f=b.sinks.list,g;for(g=0;g<f.length;g++)if(f[g].enabled)try{return new f[g](a,c,d,e)}catch(h){}throw b.Error(2)}function c(){}function d(a,c,e,f,g){e=e||c.prototype,c.prototype=new b.SinkClass,c.prototype.type=a,c.enabled=!f;var h;for(h in e)e.hasOwnProperty(h)&&(c.prototype[h]=e[h]);d[a]=c,d.list[g?"unshift":"push"](c)}return b.SinkClass=c,c.prototype=b.prototype={sampleRate:44100,channelCount:2,bufferSize:4096,writePosition:0,previousHit:0,ringOffset:0,channelMode:"interleaved",isReady:!1,start:function(a,c,d,e){this.channelCount=isNaN(c)||c===null?this.channelCount:c,this.bufferSize=isNaN(d)||d===null?this.bufferSize:d,this.sampleRate=isNaN(e)||e===null?this.sampleRate:e,this.readFn=a,this.activeRecordings=[],this.previousHit=+(new Date),b.EventEmitter.call(this),b.emit("init",[this].concat([].slice.call(arguments)))},process:function(a,c){this.emit("preprocess",arguments),this.ringBuffer&&(this.channelMode==="interleaved"?this.ringSpin:this.ringSpinInterleaved).apply(this,arguments);if(this.channelMode==="interleaved")this.emit("audioprocess",arguments),this.readFn&&this.readFn.apply(this,arguments);else{var d=b.deinterleave(a,this.channelCount),e=[d].concat([].slice.call(arguments,1));this.emit("audioprocess",e),this.readFn&&this.readFn.apply(this,e),b.interleave(d,this.channelCount,a)}this.emit("postprocess",arguments),this.previousHit=+(new Date),this.writePosition+=a.length/c},getPlaybackTime:function(){return this.writePosition-this.bufferSize},ready:function(){if(this.isReady)return;this.isReady=!0,this.emit("ready",[])}},b.sinks=b.devices=d,b.sinks.list=[],b.singleton=function(){var a=b.apply(null,arguments);return b.singleton=function(){return a},a},a.Sink=b,b}(function(){return this}());(function(a){function b(){var a;for(a in b.prototype)b.prototype.hasOwnProperty(a)&&(this[a]=b.prototype[a]);this._listeners={}}b.prototype={_listeners:null,emit:function(a,b){if(this._listeners[a])for(var c=0;c<this._listeners[a].length;c++)this._listeners[a][c].apply(this,b);return this},on:function(a,b){return this._listeners[a]=this._listeners[a]||[],this._listeners[a].push(b),this},off:function(a,b){if(this._listeners[a]){if(!b)return delete this._listeners[a],this;for(var c=0;c<this._listeners[a].length;c++)this._listeners[a][c]===b&&this._listeners[a].splice(c--,1);this._listeners[a].length||delete this._listeners[a]}return this}},a.EventEmitter=b,b.call(a)})(this.Sink),function(a){function b(a){if(!b.hasOwnProperty(a))throw b(1);if(!(this instanceof b))return new b(a);var c;for(c in b[a])b[a].hasOwnProperty(c)&&(this[c]=b[a][c]);this.code=a}b.prototype=new Error,b.prototype.toString=function(){return"SinkError 0x"+this.code.toString(16)+": "+this.message},b[1]={message:"No such error code.",explanation:"The error code does not exist."},b[2]={message:"No audio sink available.",explanation:"The audio device may be busy, or no supported output API is available for this browser."},b[16]={message:"Buffer underflow.",explanation:"Trying to recover..."},b[17]={message:"Critical recovery fail.",explanation:"The buffer underflow has reached a critical point, trying to recover, but will probably fail anyway."},b[18]={message:"Buffer size too large.",explanation:"Unable to allocate the buffer due to excessive length, please try a smaller buffer. Buffer size should probably be smaller than the sample rate."},a.Error=b}(this.Sink),function(a){function d(a){var e=null,f,g;try{return g=new b,g.append(a),f=c.createObjectURL(g.getBlob()),e=new Worker(f),e._terminate=e.terminate,e._url=f,g=null,e.terminate=function(){this._terminate(),c.revokeObjectURL(this._url)},d.type="blob",e}catch(h){}try{return e=new Worker("data:text/javascript;base64,"+btoa(a)),d.type="data",e}catch(h){}return e}var b=typeof window=="undefined"?undefined:window.BlobBuilder||window.MozBlobBuilder||window.WebKitBlobBuilder||window.MSBlobBuilder||window.OBlobBuilder,c=typeof window=="undefined"?undefined:window.URL||window.MozURL||window.webkitURL||window.MSURL||window.OURL;d.ready=d.working=!1,a.EventEmitter.call(d),d.test=function(){function c(b){if(d.ready)return;d.ready=!0,d.working=b,d.emit("ready",[b]),d.off("ready"),b&&a&&a.terminate(),a=null}var a=d("this.onmessage=function (e){postMessage(e.data)}"),b="inlineWorker";d.ready=d.working=!1,a?(a.onmessage=function(a){c(a.data===b)},a.postMessage(b),setTimeout(function(){c(!1)},1e3)):c(!1)},a.inlineWorker=d,d.test()}(this.Sink),function(a){a.doInterval=function(b,c){function f(f){a.inlineWorker.working&&!f?(d=a.inlineWorker('setInterval(function (){ postMessage("tic"); }, '+c+");"),d.onmessage=function(){b()},e=function(){d.terminate()}):(d=setInterval(b,c),e=function(){clearInterval(d)})}var d,e;return a.inlineWorker.ready?f():a.inlineWorker.on("ready",function(){f()}),function(){e?e():a.inlineWorker.ready||a.inlineWorker.on("ready",function(){e&&e()})}}}(this.Sink),function(a){a.sinks("audiodata",function(){function m(){if(d){f=e.mozWriteAudio(d),c+=f;if(f<d.length)return d=d.subarray(f),d;d=null}g=e.mozCurrentSampleOffset(),i=Number(g+(k!==g?b.bufferSize:b.preBufferSize)*b.channelCount-c),g===k&&b.emit("error",[a.Error(16)]);if(i>0||k===g){b.ready();try{j=new h(k===g?b.preBufferSize*b.channelCount:b.forceBufferSize?i<b.bufferSize*2?b.bufferSize*2:i:i)}catch(l){b.emit("error",[a.Error(18)]),b.kill();return}b.process(j,b.channelCount),f=b._audio.mozWriteAudio(j),f<j.length&&(d=j.subarray(f)),c+=f}k=g}var b=this,c=0,d=null,e=new Audio,f,g,i,j,k,l;b.start.apply(b,arguments),b.preBufferSize=isNaN(arguments[4])||arguments[4]===null?this.preBufferSize:arguments[4],e.mozSetup(b.channelCount,b.sampleRate),this._timers=[],this._timers.push(a.doInterval(function(){+(new Date)-b.previousHit>2e3&&(b._audio=e=new Audio,e.mozSetup(b.channelCount,b.sampleRate),c=0,b.emit("error",[a.Error(17)]))},1e3)),this._timers.push(a.doInterval(m,b.interval)),b._bufferFill=m,b._audio=e},{bufferSize:24576,preBufferSize:24576,forceBufferSize:!1,interval:100,kill:function(){while(this._timers.length)this._timers.shift()();this.emit("kill")},getPlaybackTime:function(){return this._audio.mozCurrentSampleOffset()/this.channelCount}},!1,!0),a.sinks.moz=a.sinks.audiodata}(this.Sink),function(a,b){function c(a){var b=document.createElement("audio");return a&&(b.src=a),b}function d(){var a=this;a.currentFrame=c(),a.nextFrame=c(),a._onended=function(){a.samples+=a.bufferSize,a.nextClip()}}b=a.sinks,b("wav",function(){function k(){if(d._audio.hasNextFrame)return;d.ready(),a.memcpy(j,0,i,0),d.process(i,d.channelCount),d._audio.setSource("data:audio/wav;base64,"+btoa(g.PCMData.encode({data:i,sampleRate:d.sampleRate,channelCount:d.channelCount,bytesPerSample:d.quality}))),d._audio.currentFrame.src||d._audio.nextClip()}var d=this,e=new b.wav.wavAudio,f=typeof f=="undefined"?g.PCMData:f;d.start.apply(d,arguments);var i=new h(d.bufferSize*d.channelCount),j=new h(d.bufferSize*d.channelCount);if(!c().canPlayType("audio/wav; codecs=1")||!btoa)throw 0;d.kill=a.doInterval(k,40),d._bufferFill=k,d._audio=e},{quality:1,bufferSize:22050,getPlaybackTime:function(){var a=this._audio;return(a.currentFrame?a.currentFrame.currentTime*this.sampleRate:0)+a.samples}}),d.prototype={samples:0,nextFrame:null,currentFrame:null,_onended:null,hasNextFrame:!1,nextClip:function(){var a=this.currentFrame;this.currentFrame=this.nextFrame,this.nextFrame=a,this.hasNextFrame=!1,this.currentFrame.play()},setSource:function(a){this.nextFrame.src=a,this.nextFrame.addEventListener("ended",this._onended,!0),this.hasNextFrame=!0}},b.wav.wavAudio=d}(this.Sink),function(a){a.sinks("dummy",function(){function c(){var a=new h(b.bufferSize*b.channelCount);b.process(a,b.channelCount)}var b=this;b.start.apply(b,arguments),b._kill=a.doInterval(c,b.bufferSize/b.sampleRate*1e3),b._callback=c},{kill:function(){this._kill(),this.emit("kill")}},!0)}(this.Sink),function(a,b){var c=typeof window=="undefined"?null:window.webkitAudioContext||window.AudioContext;a("webaudio",function(c,d,f,g){function n(a){var b=a.outputBuffer,c=b.numberOfChannels,d,f,g=b.length,j=b.size,k=new e(c),n;i.ready(),l=l&&l.length===g*c?l:new h(g*c),m=m&&m.length===l.length?m:new h(g*c),l.set(m);for(d=0;d<c;d++)k[d]=b.getChannelData(d);i.process(l,i.channelCount);for(d=0;d<g;d++)for(f=0;f<c;f++)k[f][d]=l[d*i.channelCount+f]}var i=this,j=a.webaudio.getContext(),k=j.createJavaScriptNode(f,0,d),l=null,m=null;i.start.apply(i,arguments),i.sampleRate=j.sampleRate,k.onaudioprocess=n,k.connect(j.destination),i._context=j,i._node=k,i._callback=n,b.push(k)},{kill:function(){this._node.disconnect(0);for(var a=0;a<b.length;a++)b[a]===this._node&&b.splice(a--,1);this._node=this._context=null,this.emit("kill")},getPlaybackTime:function(){return this._context.currentTime*this.sampleRate}},!1,!0),a.webkit=a.webaudio,a.webaudio.fix82795=b,a.webaudio.getContext=function(){var b=new c;return a.webaudio.getContext=function(){return b},b}}(this.Sink.sinks,[]),function(a){a.sinks("worker",function(){function g(b){a.isReady||a.initMSP(b),a.ready();var e=a.channelCount,g=b.audioLength,i,j;c=c&&c.length===g*e?c:new h(g*e),d=d&&d.length===c.length?d:new h(g*e),f=f&&f.length===c.length?f:new h(g*e),c.set(f),d.set(f),a.process(c,a.channelCount);for(i=0;i<e;i++)for(j=0;j<g;j++)d[i*b.audioLength+j]=c[i+j*e];b.writeAudio(d)}function i(b){a.isReady||a.initWA(b),a.ready();var d=b.outputBuffer,g=d.numberOfChannels,i,j,k=d.length,l=d.size,m=new e(g),n;c=c&&c.length===k*g?c:new h(k*g),f=f&&f.length===c.length?f:new h(k*g),c.set(f);for(i=0;i<g;i++)m[i]=d.getChannelData(i);a.process(c,a.channelCount);for(i=0;i<k;i++)for(j=0;j<g;j++)m[j][i]=c[i*a.channelCount+j]}var a=this,b=function(){return this}(),c=null,d=null,f=null;a.start.apply(a,arguments),importScripts(),b.onprocessmedia=g,b.onaudioprocess=i,a._mspBufferFill=g,a._waBufferFill=i},{ready:!1,initMSP:function(a){this.channelCount=a.audioChannels,this.sampleRate=a.audioSampleRate,this.bufferSize=a.audioLength*this.channelCount,this.ready=!0,this.emit("ready",[])},initWA:function(a){var b=a.outputBuffer;this.channelCount=b.numberOfChannels,this.sampleRate=b.sampleRate,this.bufferSize=b.length*this.channelCount,this.ready=!0,this.emit("ready",[])}})}(this.Sink),function(a){(function(){function b(c,d){return c&&d?b[c]=d:c&&b[c]instanceof Function&&(a.interpolate=b[c]),b[c]}a.interpolation=b,b("linear",function(a,b){var d=c.floor(b),e=d+1,f=b-d;return e=e<a.length?e:0,a[d]*(1-f)+a[e]*f}),b("nearest",function(a,b){return b>=a.length-.5?a[0]:a[c.round(b)]}),b("linear")})(),a.resample=function(b,d,e,f,g){var i=arguments.length,j=i===2?d:i===3?d/e:f/d*g/e,k=b.length,l=c.ceil(k/j),m=new h(l),n,o;for(n=0,o=0;n<k;n+=j)m[o++]=a.interpolate(b,n);return m}}(this.Sink),function(a){a.deinterleave=function(a,b){var c=a.length,d=c/b,e=[],f,g;for(f=0;f<b;f++){e[f]=new h(d);for(g=0;g<d;g++)e[f][g]=a[g*b+f]}return e},a.interleave=function(a,b,c){b=b||a.length;var d=a[0].length,e=a.length,f,g;c=c||new h(d*b);for(f=0;f<e;f++)for(g=0;g<d;g++)c[f+g*b]=a[f][g];return c},a.mix=function(a){var b=[].slice.call(arguments,1),d,e,f;for(f=0;f<b.length;f++){d=c.max(a.length,b[f].length);for(e=0;e<d;e++)a[e]+=b[f][e]}return a},a.resetBuffer=function(a){var b=a.length,c;for(c=0;c<b;c++)a[c]=0;return a},a.clone=function(a,b){var c=a.length,d;b=b||new h(c);for(d=0;d<c;d++)b[d]=a[d];return b},a.createDeinterleaved=function(a,b){var c=new e(b),d;for(d=0;d<b;d++)c[d]=new h(a);return c},a.memcpy=function(a,b,c,d,e){a=a.subarray||a.slice?a:a.buffer,c=c.subarray||c.slice?c:c.buffer,a=b?a.subarray?a.subarray(b,e&&b+e):a.slice(b,e&&b+e):a;if(c.set)c.set(a,d);else for(var f=0;f<a.length;f++)c[f+d]=a[f];return c},a.memslice=function(a,b,c){return a.subarray?a.subarray(b,c):a.slice(b,c)},a.mempad=function(b,c,d){return c=c.length?c:new b.constructor(c),a.memcpy(b,0,c,d),c},a.linspace=function(a,b,c){var d,f,g,h;c=c.length?(d=c.length)&&c:e(d=c),h=(b-a)/--d;for(g=a+h,f=1;f<d;f++,g+=h)c[f]=g;return c[0]=a,c[d]=b,c},a.ftoi=function(a,b,d){var e,f=c.pow(2,b-1);d=d||new a.constructor(a.length);for(e=0;e<a.length;e++)d[e]=~~(f*a[e]);return d}}(this.Sink),function(a){function b(b,c){a.EventEmitter.call(this),this.bufferSize=isNaN(b)||b===null?this.bufferSize:b,this.channelCount=isNaN(c)||c===null?this.channelCount:c;var d=this;this.callback=function(){return d.process.apply(d,arguments)},this.resetBuffer()}b.prototype={buffer:null,zeroBuffer:null,parentSink:null,bufferSize:4096,channelCount:2,offset:null,resetBuffer:function(){this.buffer=new h(this.bufferSize),this.zeroBuffer=new h(this.bufferSize)},process:function(a,b){this.offset===null&&this.loadBuffer();for(var c=0;c<a.length;c++)this.offset>=this.buffer.length&&this.loadBuffer(),a[c]=this.buffer[this.offset++]},loadBuffer:function(){this.offset=0,a.memcpy(this.zeroBuffer,0,this.buffer,0),this.emit("audioprocess",[this.buffer,this.channelCount])}},a.Proxy=b,a.prototype.createProxy=function(b){var c=new a.Proxy(b,this.channelCount);return c.parentSink=this,this.on("audioprocess",c.callback),c}}(this.Sink),function(a){function b(){this.ringBuffer&&(this.channelMode==="interleaved"?this.ringSpin:this.ringSpinInterleaved).apply(this,arguments)}a.on("init",function(a){a.on("preprocess",b)}),a.prototype.ringBuffer=null,a.prototype.ringSpin=function(a){var b=this.ringBuffer,c=a.length,d=b.length,e=this.ringOffset,f;for(f=0;f<c;f++)a[f]+=b[e],e=(e+1)%d;this.ringOffset=e},a.prototype.ringSpinDeinterleaved=function(a){var b=this.ringBuffer,c=a.length,d=b.length,e=b[0].length,f=d*e,g=this.ringOffset,h,i;for(h=0;h<c;h+=d){for(i=0;i<d;i++)a[h+i]+=b[i][g];g=(g+1)%e}this.ringOffset=i}}(this.Sink),function(a,b){b=a.prototype,a.on("init",function(a){a.asyncBuffers=[],a.syncBuffers=[],a.on("preprocess",a.writeBuffersSync),a.on("postprocess",a.writeBuffersAsync)}),b.writeMode="async",b.asyncBuffers=b.syncBuffers=null,b.writeBuffersAsync=function(a){var b=this.asyncBuffers,d=a.length,e,f,g,h,i;if(b)for(g=0;g<b.length;g++){e=b[g],f=e.b.length,i=e.d,e.d-=c.min(i,d);for(h=0;h+i<d&&h<f;h++)a[h+i]+=e.b[h];e.b=e.b.subarray(h+i),g>=f&&b.splice(g--,1)}},b.writeBuffersSync=function(a){var b=this.syncBuffers,c=a.length,d=0,e=0;for(;d<c&&b.length;d++){a[d]+=b[0][e];if(b[0].length<=e){b.splice(0,1),e=0;continue}e++}b.length&&(b[0]=b[0].subarray(e))},b.writeBufferAsync=function(b,c){b=this.mode==="deinterleaved"?a.interleave(b,this.channelCount):b;var d=this.asyncBuffers;return d.push({b:b,d:isNaN(c)?~~((+(new Date)-this.previousHit)/1e3*this.sampleRate):c}),d.length},b.writeBufferSync=function(b){b=this.mode==="deinterleaved"?a.interleave(b,this.channelCount):b;var c=this.syncBuffers;return c.push(b),c.length},b.writeBuffer=function(){return this[this.writeMode==="async"?"writeBufferAsync":"writeBufferSync"].apply(this,arguments)},b.getSyncWriteOffset=function(){var a=this.syncBuffers,b=0,c;for(c=0;c<a.length;c++)b+=a[c].length;return b}}(this.Sink),function(a){function b(a){this.boundTo=a,this.buffers=[],a.activeRecordings.push(this)}a.on("init",function(a){a.activeRecordings=[],a.on("postprocess",a.recordData)}),a.prototype.activeRecordings=null,a.prototype.record=function(){var b=new a.Recording(this);return this.emit("record",[b]),b},a.prototype.recordData=function(a){var b=this.activeRecordings,c,d=b.length;for(c=0;c<d;c++)b[c].add(a)},b.prototype={add:function(a){this.buffers.push(a)},clear:function(){this.buffers=[]},stop:function(){var a=this.boundTo.activeRecordings,b;for(b=0;b<a.length;b++)a[b]===this&&a.splice(b--,1)},join:function(){var a=0,b=0,c=this.buffers,d,e,f,g=c.length;for(f=0;f<g;f++)a+=c[f].length;d=new h(a);for(f=0;f<g;f++){for(e=0;e<c[f].length;e++)d[b+e]=c[f][e];b+=c[f].length}return d}},a.Recording=b}(this.Sink),w.prototype={sampleRate:44100,threshold:.95,attack:.01,release:.01,__amplitude:null,sample:0,pushSample:function(a){var b=this._amplitude.pushSample(a)-this.threshold;return this.sample=b>0?a/(1+b):a,this.sample},getMix:function(){return this.sample},setParam:function(a,b){switch(a){case"attack":case"release":this._amplitude[a]=b;default:this[a]=b}}},x.prototype={channelCount:2,sample:[0,0],wet:.5,dry:.55,damping:.2223,roomSize:.5,tuning:{},pushSample:function(a,b){var c=a*this.tuning.fixedGain,d=0,e;for(e=0;e<this.numCFs;e++)d+=this.CFs[b][e].pushSample(c);for(e=0;e<this.numAPFs;e++)d=this.APFs[b][e].pushSample(d);this.sample[b]=d*this.wet+a*this.dry},getMix:function(a){return this.sample[a]},reset:function(){var a,b;for(b=0;b<this.channelCount;b++){for(a=0;a<this.numCFs;a++)this.CFs[b][a].reset();for(a=0;a<this.numAPFs;a++)this.APFs[b][a].reset();this.sample[b]=0}},setParam:function(a,b){var c,d,e,f;switch(a){case"roomSize":this.roomSize=b,c=this.roomSize*this.tuning.scaleRoom+this.tuning.offsetRoom;for(f=0;f<this.channelCount;f++)for(e=0;e<this.numCFs;e++)this.CFs[f][e].setParam("feedback",c);break;case"damping":this.damping=b,d=this.damping*this.tuning.scaleDamping;for(f=0;f<this.channelCount;f++)for(e=0;e<this.numCFs;e++)this.CFs[f][e].setParam("damping",d);break;default:this[a]=b}}},x.Tuning=function(b){var c;if(b)for(c in b)b.hasOwnProperty(c)&&(this[c]=b[c])},x.Tuning.prototype={combCount:8,combTuning:[1116,1188,1277,1356,1422,1491,1557,1617],allPassCount:4,allPassTuning:[556,441,341,225],allPassFeedback:.5,fixedGain:.015,scaleDamping:.9,scaleRoom:.28,offsetRoom:.7,stereoSpread
:23},x.AllPassFilter=function(b,c,d){var e=this;e.sampleRate=b,e.buffer=new h(isNaN(c)?500:c),e.bufferSize=e.buffer.length,e.feedback=isNaN(d)?e.feedback:d},x.AllPassFilter.prototype={sample:0,index:0,feedback:.5,pushSample:function(a){var b=this;return bufOut=b.buffer[b.index],b.sample=-a+bufOut,b.buffer[b.index++]=a+bufOut*b.feedback,b.index>=b.bufferSize&&(b.index=0),b.sample},getMix:function(){return this.sample},reset:function(){this.index=0,this.sample=0,this.buffer=new h(this.bufferSize)}},y.prototype={sample:0,index:0,store:0,feedback:.84,damping:.2,pushSample:function(a){var b=this;return b.sample=b.buffer[b.index],b.store=b.sample*b.invDamping+b.store*b.damping,b.buffer[b.index++]=a+b.store*b.feedback,b.index>=b.bufferSize&&(b.index=0),b.sample},getMix:function(){return this.sample},reset:function(){this.index=this.store=0,this.samples=0,this.buffer=new h(this.bufferSize)},setParam:function(a,b){switch(a){case"damping":this.damping=b,this.invDamping=1-b;break;default:this[a]=b}}},A.BiquadFilterClass=function R(){var a;for(a in R.prototype)R.prototype.hasOwnProperty&&(this[a]=this[a])},A.BiquadFilterClass.prototype={sampleRate:44100,sample:0,inputs:null,outputs:null,coefs:null,pushSample:function(a){var b=this.coefs,c=this.inputs,d=this.outputs;return this.sample=b.b0*a+b.b1*c[0]+b.b2*c[1]-b.a1*d[0]-b.a2*d[1],c.pop(),c.unshift(a),d.pop(),d.unshift(this.sample),this.sample},getMix:function(){return this.sample},reset:function(a,b,c,d,e,f){this.inputs=[0,0],this.outputs=[0,0],this.sampleRate=isNaN(a)?this.sampleRate:a,arguments.length>1&&(this.coefs={b0:b,b1:c,b2:d,a1:e,a2:f})}},A.LowPass=function(a,b,d){var e=2*c.PI*b/a,f=c.cos(e),g=c.sin(e),h=g/(2*d),i=(1-f)/2,j=1-f,k=i,l=1+h,m=-2*f,n=1-h;this.reset(a,i/l,j/l,k/l,m/l,n/l)},A.HighPass=function(a,b,d){var e=2*c.PI*b/a,f=c.cos(e),g=c.sin(e),h=g/(2*d),i=(1+f)/2,j=-(1+f),k=i,l=1+h,m=-2*f,n=1-h;this.reset(a,i/l,j/l,k/l,m/l,n/l)},A.AllPass=function(a,b,d){var e=2*c.PI*b/a,f=c.cos(e),g=c.sin(e),h=g/(2*d),i=1-h,j=-2*f,k=1+h,l=k,m=j,n=i;this.reset(a,i/l,j/l,k/l,m/l,n/l)},A.BandPass=function(a,b,d){var e=2*c.PI*b/a,f=c.cos(e),g=c.sin(e),h=c.log(2)/2*d*e/g,i=g*(c.exp(h)-c.exp(-h))/2,j=i,k=0,l=-i,m=1+i,n=-2*f,o=1-i;this.reset(a,j/m,k/m,l/m,n/m,o/m)},function(a,b){for(b=0;b<a.length;b++)a[b].prototype=new A.BiquadFilterClass}([A,A.LowPass,A.HighPass,A.AllPass,A.BandPass]),E.prototype={sampleRate:1,time:1e3,feedback:0,bufferPos:0,buffer:null,sample:0,_rstf:1,pushSample:function(a){var b=this,c=b.buffer;return c[b.bufferPos++]+=a,b.bufferPos>b.time*b._rstf&&(b.bufferPos=0),b.sample=c[b.bufferPos],c[b.bufferPos]*=b.feedback,b.sample},getMix:function(){return this.sample},resample:function(a){var b=this,d=b.time/a;return b.buffer=g.Sink.resample(b.buffer,a),b.time=a,b.bufferPos=c.round(d*b.bufferPos),b.buffer},reset:function(a,b){var d=this,e=d.buffer,f,i;a=isNaN(a)?d.sampleRate:a,i=d.sampleRate/a,d.buffer=new h(a*E.MAX_DELAY),d.bufferPos=c.round(i*d.bufferPos),d._rstf=.001*a;if(b){e=g.Sink.resample(e,i);for(f=0;f<e.length&&f<d.buffer.length;f++)d.buffer[f]=e[f]}return d.buffer}},E.MAX_DELAY=2,G.prototype={sampleRate:44100,sample:0,pos:0,kernels:null,buffer:null,pushSample:function(a){var b,c,d;this.sample=0,this.buffer[this.pos]=a;for(c=0,d=this.buffer.length,b=this.pos+d;c<d;c++)this.sample+=this.kernels[c]*this.buffer[(b-c)%d];this.pos=(this.pos+1)%this.buffer.length},getMix:function(){return this.sample},setParam:function(a,b){switch(a){case"kernels":this.buffer=new h(b.length),this.pos=0}this[a]=b}},H.prototype={sampleRate:44100,gain:1,sample:0,pushSample:function(a){return this.sample=a*this.gain,this.sample},getMix:function(){return this.sample}},function(a,b,d,e){d=I.prototype={sampleRate:44100,frequency:440,phaseOffset:0,pulseWidth:.5,fm:0,waveShape:"sine",phase:0,_p:0,generate:function(){var a=this,b=+a.frequency,c=a.pulseWidth,d=a.phase;b+=b*a.fm,a.phase=(d+b/a.sampleRate/2)%1,d=(a.phase+a.phaseOffset)%1,a._p=d<c?d/c:(d-c)/(1-c)},getMix:function(){return this[this.waveShape]()},getPhase:function(){return this._p},reset:function(a){this.phase=this._p=isNaN(a)?0:a},setWavetable:function(a){return this.waveTable=a,!0},sine:function(){return c.sin(this._p*a)},triangle:function(){return this._p<.5?4*this._p-1:3-4*this._p},square:function(){return this._p<.5?-1:1},sawtooth:function(){return 1-this._p*2},invSawtooth:function(){return this._p*2-1},pulse:function(){return this._p<.5?this._p<.25?this._p*8-1:1-(this._p-.25)*8:-1},wavetable:function(){return g.Sink.interpolate(this.waveTable,this._p*this.waveTable.length)},waveShapes:[]};for(e=0;e<b.length;e++)d[e]=d[b[e]],d.waveShapes.push(d[e]);I.WaveShape=function(a,b){return b&&(this.prototype[a]=b),this.prototype[a]},I.createMixWave=function(a,b){var c=b.length,d,e;return this.WaveShape(a,function(){d=0;for(e=0;e<c;e++)d+=this[b[e].shape]()*b[e].mix;return d})}}(c.PI*2,["sine","triangle","pulse","sawtooth","invSawtooth","square"]),J.prototype={sampleRate:44100,color:"white",b0:0,b1:0,b2:0,b3:0,b4:0,b5:0,c1:null,c2:null,c3:null,c4:null,q:15,q0:null,q1:null,brownQ:0,value:0,reset:function(a,b){this.sampleRate=isNaN(a)?this.sampleRate:a,this.color=typeof b=="string"?b:this.color,this.c1=(1<<this.q)-1,this.c2=~~(this.c1/3)+1,this.c3=1/this.c1,this.c1=this.c2*6,this.c4=3*(this.c2-1),this.q0=c.exp(-200*c.PI/this.sampleRate),this.q1=1-this.q0},generate:function(){this.value=this[this.color]()},getMix:function(){return this.value},white:function(){var a=c.random();return(a*this.c1-this.c4)*this.c3},pink:function(){var a=this.white();return this.b0=.997*this.b0+.029591*a,this.b1=.985*this.b1+.032534*a,this.b2=.95*this.b2+.048056*a,this.b3=.85*this.b3+.090579*a,this.b4=.62*this.b4+.10899*a,this.b5=.25*this.b5+.255784*a,.55*(this.b0+this.b1+this.b2+this.b3+this.b4+this.b5)},brown:function(){var a=this.white();return this.brownQ=this.q1*a+this.q0*this.brownQ,6.2*this.brownQ}},K.prototype={sampleRate:44100,pitch:440,delayStart:0,delayEnd:0,maxVoices:1/0,sampleSize:0,voices:null,sample:null,samples:null,data:null,noteOn:function(a,b){a=isNaN(a)?this.pitch:a;var c=this,d=a/c.pitch,e=c.sampleRate,f=e*c.delayStart,g=c.sampleSize-e*c.delayEnd-1,h={f:a,p:f,s:d,l:g,v:isNaN(b)?1:b};c.voices.push(h);while(c.voices.length>c.maxVoices)g=c.voices.shift(),g.onend&&g.onend();return h},generate:function(){var a=this.voices,b,c;for(b=0;b<a.length;b++)c=a[b],c.p+=c.s,c.p>c.l&&a.splice(b--,1)&&c.onend&&c.onend()},getMix:function(a){var b=this.voices,c=0,d;a=a||0;if(this.samples[a])for(d=0;d<b.length;d++)c+=g.Sink.interpolate(this.samples[a],b[d].p)*b[d].v;return c},load:function(a,b){var c=this,d=c.samples=g.Sink.deinterleave(a.data,a.channelCount),e;if(b)for(e=0;e<d.length;e++)d[e]=g.Sink.resample(d[e],a.sampleRate,c.sampleRate);c.sample=a.data,c.samples=d,c.data=a,c.sampleSize=d[0].length}},L.prototype={bufferPos:-1,pushSample:function(a){return this.bufferPos=(this.bufferPos+1)%this.buffer.length,this.bufferPos===0&&this.process(this.buffer),this.buffer[this.bufferPos]=a,a},getMix:function(){return this.buffer[this.bufferPos]},resetBuffer:function(a){this.bufferSize=isNaN(a)?this.bufferSize:a,this.buffer=new h(this.bufferSize),this.bufferPos=-1}},this.FourierTransform=function(){function l(a,b){var c;for(c in l.prototype)l.prototype.hasOwnProperty&&(this[c]=l.prototype[c]);L.apply(this,[].slice.call(arguments,1)),this.resetFT.apply(this,arguments)}var a=c.sin,b=c.cos,d=c.sqrt,e=c.floor,f=c.pow,g=c.log,i=c.ln2,j=c.PI,k=j*2;return l.prototype={resetFT:function(a){var b=this;b.sampleRate=isNaN(a)?b.sampleRate:a,b.bandWidth=2/b.bufferSize*b.sampleRate*.5,b.spectrum=new h(b.bufferSize*.5),b.peakBand=0,b.peak=0},getBandFrequency:function(a){return this.bandwidth*a+this.bandWidth*.5},calculateSpectrum:function(){var a=this,b=a.spectrum,c=2/a.bufferSize,e=a.bufferSize/2,f,g,h,i,j;for(i=0;i<e;i++)j=i*2,f=a.buffer[i*2],g=a.buffer[i*2+1],h=c*d(f*f+g*g),h>a.peak&&(a.peakBand=i,a.peak=h),b[i]=h}},l}();var M=function(){function e(c,e,f,g){var h=(g?d:-d)*e/f;c[0]=b(h),c[1]=a(h)}function f(a,b,c,d){var f=a.length*.5,g=0,i=0,j=2,k=f/j,l=f/d,m=d/j,n=(j-1)*m,o=new h(2),p,q,r,s,t,u,v,w,x,y;for(p=0;p<l;p++,i+=n){e(o,p,l*j,c);for(q=0;q<m;q++,g++,i++)r=a[2*g],s=a[2*g+1],t=a[2*(g+k)],u=a[2*(g+k)+1],v=r+t,w=s+u,x=r-t,y=s-u,b[2*i]=v,b[2*i+1]=w,b[2*(i+m)]=o[0]*x-o[1]*y,b[2*(i+m)+1]=o[0]*y+o[1]*x}}function g(a,b,c,d){var e=1,g=0,h=a.length*.5,i=c.length,j,k,l,m;for(m=0;m<i;m++)l=c[m],e*=l,g===0?(j=a,k=b,g=1):(j=b,k=a,g=0),l===2&&f(j,k,d,e);if(d){if(g===1)for(m=0;m<h;m++)a[2*m]=b[2*m],a[2*m+1]=b[2*m+1]}else if(g===1)for(m=0;m<h;m++)a[2*m]=b[2*m]/h,a[2*m+1]=b[2*m+1]/h;else for(m=0;m<h;m++)a[2*m]=a[2*m]/h,a[2*m+1]=a[2*m+1]/h}function i(){this.reset.apply(this,arguments)}var a=c.sin,b=c.cos,d=c.PI*2;return i.prototype={factors:null,scratch:null,bufferSize:2048,reset:function(a){this.bufferSize=isNaN(a)?this.bufferSize:this.bufferSize,this.factors=[2,2,2,2,2,2,2,2,2,2],this.scratch=new h(this.bufferSize)},forward:function(a){g(a,this.scratch,this.factors,!0)},backward:function(a){g(a,this.scratch,this.factors,!1)}},i}();return function(a){a.resetFFT=a.reset,a.reset=function(a,b){g.FourierTransform.apply(this,arguments),this.resetBuffer.apply(this,[].slice.call(arguments,1)),this.resetFT.apply(this,arguments),this.resetFFT.apply(this,[].slice.call(arguments,1))},a.process=function(a){return this[this.method](a||this.buffer),this.calculateSpectrum()},a.setParam=function(a,b){switch(a){case"bufferSize":if(this.bufferSize===b)break;this.fullScratch=this.fullScratch||this.scratch,this.fullScratch.length<b&&(this.fullScratch=new h(b)),this.scratch=this.fullScratch.subarray(0,b)}this[a]=b},a.resetScratch=function(){this.fullScratch=null,this.scratch=new h(this.bufferSize)},a.fullScratch=null,a.sampleRate=44100,a.method="forward"}(M.prototype),N.prototype={sampleRate:44100,attack:.01,release:.01,sample:0,pushSample:function(a){return this.sample=c.abs((a>this.sample?this.attack:this.release)*(this.sample-a)+a),this.sample},getMix:function(){return this.sample}},O.prototype={sampleRate:44100,attack:50,decay:50,sustain:1,release:50,sustainTime:null,releaseTime:null,gate:!1,state:3,value:0,_st:0,generate:function(){return this.states[this.state].call(this),this.value},getMix:function(){return this.value},triggerGate:function(a){a=typeof a=="undefined"?!this.gate:a,this.gate=a,this.state=a?0:this.releaseTime===null?3:5,this._st=0},states:[function(){this.value+=1e3/this.sampleRate/this.attack,this.value>=1&&(this.state=1)},function(){this.value-=1e3/this.sampleRate/this.decay*this.sustain,this.value<=this.sustain&&(this.sustainTime===null?this.state=2:(this._st=0,this.state=4))},function(){this.value=this.sustain},function(){this.value=c.max(0,this.value-1e3/this.sampleRate/this.release)},function(){this.value=this.sustain,this._st++>=this.sampleRate*.001*this.sustainTime&&(this._st=0,this.state=this.releaseTime===null?3:5)},function(){this.value=c.max(0,this.value-1e3/this.sampleRate/this.release),this._st++>=this.sampleRate*.001*this.releaseTime&&(this._st=0,this.state=0)}]},P.prototype={sampleRate:44100,value:1,schedule:null,clock:0,getMix:function(){return this.value},generate:function(){var a;for(a=0;a<this.schedule.length;a++)this.schedule[a].t--&&(this.value=this.schedule[a].v,this.schedule.splice(a--,1))},setValue:function(a){this.schedule.push({v:a,t:~~((+(new Date)-this.clock)/1e3*this.sampleRate)})},reset:function(a){this.value=isNaN(a)?this.value:a,this.clock=+(new Date)}},Q.prototype={sampleRate:44100,stepLength:200,steps:null,attack:0,phase:0,value:0,generate:function(){var a=this,b=a.sampleRate/1e3*a.stepLength,c=a.steps,d=b*c.length,e,f,g,h,i;return a.phase=(a.phase+1)%d,e=a.phase/d*c.length,f=e%1,e=~~e,g=(e||c.length)-1,h=c[e]-c[g],i=c[e],f<a.attack&&(i-=h-h/a.attack*f),a.value=i,i},getMix:function(){return this.value},triggerGate:function(){this.phase=0}},g.ADSREnvelope=O,g.StepSequencer=Q,g.UIControl=P,g.BiquadFilter=A,g.BitCrusher=v,g.Chorus=C,g.CombFilter=y,g.Compressor=B,g.Convolution=G,g.Delay=E,g.Distortion=F,g.GainController=H,g.IIRFilter=z,g.LP12Filter=D,g.Limiter=w,g.Reverb=x,g.Noise=J,g.Oscillator=I,g.Sampler=K,g.Amplitude=N,g.FFT=M,g.AudioProcessingUnit=L,g.AudioDevice=g.Sink=function(){return this}().Sink,function(a,b){function c(a){return new g.BufferEffect(this,a,[].slice.call(arguments,1))}function d(a,b,e,f){if(b){e=e||b.prototype;var g=b.prototype=new s;g.name=g.fxid=a,d[a]=m(a,b,f),d[a].createBufferBased=b.createBufferBased=c;for(f in e)e.hasOwnProperty(f)&&(g[f]=e[f])}return d[a]}g.effects=d;for(b=0;b<a.length;b++)g[a[b]]=d(a[b],g[a[b]],g[a[b]].prototype);d("BiquadAllPassFilter",A.AllPass),d("BiquadBandPassFilter",A.BandPass),d("BiquadHighPassFilter",A.HighPass),d("BiquadLowPassFilter",A.LowPass),d("FreeverbAllPassFilter",x.AllPassFilter)}(["BiquadFilter","BitCrusher","Chorus","CombFilter","Compressor","Convolution","Delay","Distortion","GainController","IIRFilter","LP12Filter","Limiter","Reverb","Amplitude","FFT"]),function(a,b){function c(a,b,d,e){if(b){d=d||b.prototype;var f=b.prototype=new t;f.name=f.fxid=a,c[a]=m(a,b,e);for(e in d)d.hasOwnProperty(e)&&(f[e]=d[e])}return c[a]}g.generators=c;for(b=0;b<a.length;b++)g[a[b]]=c(a[b],g[a[b]],g[a[b]].prototype)}(["Noise","Oscillator","Sampler","ADSREnvelope","StepSequencer","UIControl"]),q("wav",g.PCMData),g.Automation=o,g.BufferEffect=r,g.EffectClass=s,g.GeneratorClass=t,g.codecs=g.Codec=q,g.plugins=p,g.version="0.6.1",g.BufferEffect.prototype.addAutomation=g.EffectClass.prototype.addAutomation=g.GeneratorClass.prototype.addAutomation=function(){return g.Automation.apply(g,[this].concat([].slice.call(arguments)))},g}.call(typeof exports=="undefined"?{}:this,this.window||global,Math,Object,Array);